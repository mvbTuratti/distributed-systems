import{o as _,a as u,c as h,b as L,t as m,d as c,e as p,n as v,r as f,F as M,f as V,w as I,v as O,g as $,h as j,i as E,j as P,k as D}from"./vendor.24517251.js";const K=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&d(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function d(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}};K();const z=["id"],A={key:0,class:"chat-header"},F={class:"text-xs opacity-50"},T={key:1,class:"chat-footer opacity-50"},C={props:{user:String,sender:{type:Boolean,default:!0},timestamp:{type:String,default:new Date().toLocaleString()},message:{type:String,default:""},status:{type:Boolean,default:!1},first:{type:Boolean,default:!0},last:{type:Boolean,default:!0},hash:{type:String}},setup(o){const l=o;return _(()=>{document.getElementById(l.hash).scrollIntoView({behavior:"smooth"})}),(n,d)=>(u(),h("div",{class:v(["chat",o.sender?"chat-end":"chat-start"]),id:o.hash},[o.first?(u(),h("div",A,[L(m(o.sender?"":o.user)+" ",1),c("time",F,m(o.timestamp),1)])):p("",!0),c("div",{class:v(["chat-bubble",o.sender?"chat-bubble-info":"chat-bubble-accent"])},m(o.message),3),o.last&&o.sender?(u(),h("div",T,m(o.status?"Delivered":"Sending..."),1)):p("",!0)],10,z))}},H={class:"flex flex-col h-screen"},R={key:0,class:"h-20 flex justify-center"},q=c("div",{role:"alert",class:"alert alert-error w-[80%] mt-4"},[c("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})]),c("span",null,"Error! Lost connection to server")],-1),J=[q],U={id:"chat",class:"flex-1 px-12 mb-8 scrollable-content p-4 overflow-y-auto"},W={id:"input_text",class:"h-16 flex justify-center p-2"},G=["onKeyup"],Q={class:"h-8"},X={class:"text-xs opacity-50 text-white"},Y={setup(o){const l=f(""),n=f([]),d=new Set;let t=null;const a=f(!1),i=f(1e3),g=f(""),y=new Set;function x(s){return n.value.length&&n.value[n.value.length-1].user===s?(n.value[n.value.length-1].last=!1,!1):!0}function B(s){if(a.value){let e=N();n.value.push({user:"",sender:!0,hash:e,message:l.value,last:!0,first:x(""),status:!1}),t.send(`${e} - ${l.value}`),d.add(e),l.value=""}}function N(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let r=0;r<16;r++){const S=Math.floor(Math.random()*s.length);e+=s.charAt(S)}return e}function w(s){try{let e=JSON.parse(s.data);if(!d.has(e.hash)&&!y.has(e.name))n.value.push({user:e.name,hash:e.hash,sender:!1,message:e.content,last:!0,first:x(e.name),timestamp:e.timestamp});else for(let r=0;r<n.value.length;r++)n.value[r].hash===e.hash&&(n.value[r].status=!0)}catch{y.add(s.data),g.value=s.data}}function b(){a.value=!1,a.value||(setTimeout(k,i.value),i.value=Math.ceil(i.value+2e3,1e4))}_(()=>{fetch("http://localhost:8000/messages/").then(s=>s.json()).then(s=>{console.log(s);for(let e=0;e<s.messages.length;e++)w(s.messages[e])}),k()});function k(){t=new WebSocket("ws://localhost:8000/ws"),t.onopen=()=>{a.value=!0},t.onmessage=s=>{w(s)},t.onclose=s=>{b()},t.onerror=s=>{b()}}return(s,e)=>(u(),h("div",H,[a.value?p("",!0):(u(),h("div",R,J)),c("div",U,[(u(!0),h(M,null,V(n.value,r=>(u(),j(C,E(P(r)),null,16))),256))]),c("div",W,[I(c("input",{type:"text",placeholder:"",onKeyup:$(B,["enter"]),"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),class:v(["input input-bordered w-full mx-8",a.value?"":" input-disabled"])},null,42,G),[[O,l.value]])]),c("div",Q,[c("span",X,m(g.value),1)])]))}};D(Y).mount("#app");
